## CRITICAL (must fix before production)
- [Security] Unescaped QA/QC notes are injected into `innerHTML`, allowing stored XSS from user-entered content — `js/interview/guided-sections.js:88-92` — impact: any inspector can inject scripts that execute for any viewer of the report — suggested fix: wrap `note` with `escapeHtml()` or render via `textContent`/DOM nodes.
- [Security] Photo captions are injected into `textarea` innerHTML without escaping (guided mode) — `js/interview/guided-sections.js:312-356` — impact: captions like `</textarea><script>…</script>` execute on render — suggested fix: create textarea elements and assign `.value`, or escape before string interpolation.
- [Security] Photo captions are injected into `textarea` innerHTML without escaping (minimal/freeform mode) — `js/interview/freeform.js:332-376` — impact: same stored XSS vector as above — suggested fix: render textareas via DOM and set `.value`.
- [Security] Work summary text is injected into HTML without escaping — `js/report/form-fields.js:227-233` — impact: stored XSS in report editor — suggested fix: escape content or set textarea `.value` after DOM creation.
- [Security] Weather fields are inserted via `innerHTML` without escaping — `js/report/original-notes.js:63-67` — impact: stored XSS if weather fields contain HTML — suggested fix: use `textContent`/`escapeHtml` and avoid `innerHTML` for user data.

## HIGH (should fix soon)
- [Data Integrity] Photo upload can orphan storage files when metadata upsert fails — `js/interview/persistence.js:965-997` — impact: storage bloat + photos missing from reports while still billed/stored — suggested fix: on metadata error, delete the uploaded storage object or mark `syncStatus='failed'` and persist `storagePath` for retry/cleanup.
- [Data/Security] Reports are upserted without `org_id`, so rows can end up with `org_id = NULL` (or fail RLS if policies require org scoping) — `js/report/autosave.js:237-246`, `js/interview/persistence.js:875-884`, `js/report/submit.js:132-142` — impact: reports become invisible to org-filtered queries or violate tenant isolation — suggested fix: always include `org_id` from `RS.activeProject.orgId` or `STORAGE_KEYS.ORG_ID` on report upserts and updates.
- [Security] Realtime subscription to `report_data` has no filter — `js/shared/realtime-sync.js:44-48` — impact: if RLS is permissive or misconfigured, client can receive other tenants’ report content; also increases bandwidth — suggested fix: add a filter for `report_id` set or `org_id` (and confirm RLS is enforced for Realtime).
- [Security] PDFs are stored with `getPublicUrl()` (implies public bucket) — `js/report/submit.js:117-122`, consumed in `js/archives/main.js:171-214` — impact: anyone with the URL can access reports if bucket is public — suggested fix: use private bucket + signed URLs, or enforce access control on retrieval.

## MEDIUM (improvement opportunities)
- [Reliability] `STATIC_ASSETS` list in the service worker includes many non-existent `js/interview/*.js` files, causing `cache.addAll()` to reject and leaving offline cache incomplete — `sw.js:49-67, 125-136` — impact: flaky/failed offline installs — suggested fix: remove stale paths or generate the list from actual build output.
- [PWA/Offline] Navigation requests are ignored by the service worker, so offline page loads get no cached fallback — `sw.js:181-186` — impact: offline navigation shows browser error page even though cached HTML exists — suggested fix: `event.respondWith(handleStaticRequest(...))` for navigations or provide an offline page.
- [Stability] Malformed `contractors` JSON can crash project loading — `js/supabase-utils.js:54` — impact: a single bad row breaks project list and downstream pages — suggested fix: wrap `JSON.parse` in try/catch and fall back to `[]`.
- [UX/Perf] `archives/main.js` re-attaches event listeners on each `init()` (including inside `online` handler), causing duplicate handlers and repeated loads — `js/archives/main.js:21-49` — impact: multiple fetches per action and memory growth — suggested fix: guard with a one-time flag or remove listeners before re-adding.
- [Auth] Session is only checked on page load; no `onAuthStateChange` to handle token expiry mid-session — `js/auth.js:16-42, 197-211` — impact: requests fail silently, users remain on protected pages without a valid session — suggested fix: add auth state listener and redirect on sign-out/expiry.
- [Security/Scoping] Many queries rely on `localStorage` for `ORG_ID`/`USER_ID` (not the auth JWT), so if those values are missing/stale, queries become unscoped — e.g. `js/data-layer.js:29-90`, `js/archives/main.js:56-118`, `js/index/cloud-recovery.js:16-42` — impact: data leakage if RLS is weak and inconsistent results after storage eviction — suggested fix: derive scope from auth session (JWT claims) and enforce RLS in Supabase.

## LOW (nice to have)
- [Security/HTML] Contractor names are injected into placeholder attributes without escaping — `js/report/form-fields.js:275-277` — impact: attribute-breaking HTML if names contain quotes; low probability but easy fix — suggested fix: set `placeholder` via DOM property or escape quotes.
- [Security] `window.open(report.pdfUrl, '_blank')` lacks `noopener` — `js/archives/main.js:239-252` — impact: potential tabnabbing if untrusted URLs ever get stored — suggested fix: `window.open(url, '_blank', 'noopener')` or create `<a rel="noopener">`.

## ARCHITECTURE NOTES
- Supabase RLS policies are not present in this repo. Given the client writes/reads directly from `reports`, `report_data`, `photos`, `projects`, `user_profiles`, `interview_backup`, and `organizations`, RLS is the real security boundary. Please verify: `auth.uid()` is enforced, `org_id` is enforced on all tenant tables, and Realtime uses the same policies.
- The app is script-tag ordered with multiple global namespaces (`window.reportState`, `window.interviewState`). This is workable, but brittle. Consider centralizing shared state and initialization sequencing (or using `defer` consistently + a top-level bootstrap).
- There are three sources of report truth (localStorage report data, `report_data` table, `interview_backup` table). Conflict resolution is “last write wins” with no vector clocks. Multi-device edits can overwrite each other silently; consider revision IDs or `updated_at` checks when merging.
- Some third-party webhooks are called directly from the client (AI refine and document extraction). If these are not protected by auth/secret headers server-side, they are trivially callable by anyone who can view the JS. Consider adding auth or rate limiting.
